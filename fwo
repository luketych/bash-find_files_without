#!/bin/bash

# Print usage information
usage() {
    echo "Usage: ffwo.sh [options] <directory>"
    echo "Find files that don't match certain criteria"
    echo
    echo "Options:"
    echo "  -v, --verbose            Enable verbose output"
    echo "  -p, --print-screen      Print results to screen"
    echo "  -c, --ansi              Enable ANSI color output"
    echo "  -d, --depth DEPTH       Search depth (default: 2)"
    echo "  -X, --extensions EXT    Additional file extensions to exclude"
    echo "  -D, --directories DIR   Directories to exclude"
    echo "  -S, --substrings STR    Substrings to exclude"
    echo "  -s|--search-dir DIR    Directory to search (default: .)"
    echo "      --temp-file FILE    Output file for results"
    echo "      --no-text-files     Disable text file exclusions"
    echo "      --no-package-files  Disable package file exclusions"
    echo "      --no-web-files      Disable web file exclusions"
    echo "  -h, --help              Show this help message"
}

# Function to show error and usage for options requiring values
show_option_error() {
    local option=$1
    echo "Error: $option requires a value"
    echo "Usage: ffwo.sh $option VALUE"
    echo "Use -h or --help to see available options"
    exit 1
}

# Initialize variables with defaults
VERBOSE="false"
PRINT_SCREEN="true"
ANSI="true"
DEPTH="2"
EXTENSIONS=""
DIRECTORIES=""
SUBSTRINGS=""
SEARCH_DIR="."
TEMP_FILE="./tmp/result.txt"
USE_TEXT_FILES="true"
USE_PACKAGE_FILES="true"
USE_WEB_FILES="true"

# Parse command line options
while [[ "$#" -gt 0 ]]; do
    case "$1" in
        -v|--verbose)
            VERBOSE="true"
            shift
            ;;
        -p|--print-screen)
            PRINT_SCREEN="true"
            shift
            ;;
        -c|--ansi)
            ANSI="true"
            shift
            ;;
        -d|--depth)
            if [[ -z "$2" || "$2" =~ ^- ]]; then
                show_option_error "--depth"
            fi
            DEPTH="$2"
            shift 2
            ;;
        -X|--extensions)
            if [[ -z "$2" || "$2" =~ ^- ]]; then
                show_option_error "--extensions"
            fi
            EXTENSIONS="$2"
            shift 2
            ;;
        -D|--directories)
            if [[ -z "$2" || "$2" =~ ^- ]]; then
                show_option_error "--directories"
            fi
            DIRECTORIES="$2"
            shift 2
            ;;
        -S|--substrings)
            if [[ -z "$2" || "$2" =~ ^- ]]; then
                show_option_error "--substrings"
            fi
            SUBSTRINGS="$2"
            shift 2
            ;;
        -s|--search-dir)
            if [[ -z "$2" || "$2" =~ ^- ]]; then
                show_option_error "--search-dir"
            fi
            SEARCH_DIR="$2"
            shift 2
            ;;
        --temp-file)
            if [[ -z "$2" || "$2" =~ ^- ]]; then
                show_option_error "--temp-file"
            fi
            TEMP_FILE="$2"
            shift 2
            ;;
        --no-text-files)
            USE_TEXT_FILES="false"
            shift
            ;;
        --no-package-files)
            USE_PACKAGE_FILES="false"
            shift
            ;;
        --no-web-files)
            USE_WEB_FILES="false"
            shift
            ;;
        -h|--help)
            usage
            exit 0
            ;;
        *)
            echo "Unknown option: $1"
            echo "Use -h or --help to see available options"
            exit 1
            ;;
    esac
done

# Source the function file
source "$(dirname "$0")/find_files_without.sh"

# Call the main function with all parameters
find_files_without \
    "search_dir=$SEARCH_DIR" \
    "depth=$DEPTH" \
    "extensions=$EXTENSIONS" \
    "directories=$DIRECTORIES" \
    "substrings=$SUBSTRINGS" \
    "use_text_files=$USE_TEXT_FILES" \
    "use_package_files=$USE_PACKAGE_FILES" \
    "use_web_files=$USE_WEB_FILES" \
    "ansi=$ANSI" \
    "print_screen=$PRINT_SCREEN" \
    "verbose=$VERBOSE" \
    "temp_file=$TEMP_FILE"